<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY-IA - Interface de Chat</title>
    <!-- CSS principal (modules disponibles dans css/ pour maintenance) -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>
<body>
    <!-- Loading Screen - Masque le FOUC -->
    <div id="app-loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <div class="loader-text">Chargement...</div>
        </div>
    </div>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <h1>MY-IA</h1>
                <p>Connectez-vous pour acceder a votre assistant IA</p>
            </div>

            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="votre@email.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="Votre mot de passe" required>
                </div>
                <div class="login-error" id="loginError" style="display: none;"></div>
                <button type="submit" class="btn-login" id="loginBtn">Se connecter</button>
            </form>

            <div class="login-separator">
                <span>ou</span>
            </div>

            <button class="btn-register-toggle" id="showRegisterBtn">Creer un compte</button>

            <!-- Register Form (hidden by default) -->
            <form id="registerForm" class="register-form" style="display: none;">
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="votre@email.com" required>
                </div>
                <div class="form-group">
                    <label for="registerUsername">Nom d'utilisateur</label>
                    <input type="text" id="registerUsername" placeholder="Votre pseudo" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mot de passe</label>
                    <input type="password" id="registerPassword" placeholder="Minimum 8 caracteres" required minlength="8">
                </div>
                <div class="login-error" id="registerError" style="display: none;"></div>
                <button type="submit" class="btn-login">S'inscrire</button>
                <button type="button" class="btn-back-login" id="backToLoginBtn">Retour a la connexion</button>
            </form>
        </div>
    </div>

    <!-- Main App Container (hidden when not logged in) -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-header-top">
                    <h1>MY-IA</h1>
                    <div class="sidebar-header-actions">
                        <button class="btn-header-icon" id="newChatBtn" data-tooltip="Nouvelle conversation">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="conversations-list" id="conversationsList">
                <!-- Les conversations seront ajoutÃ©es ici dynamiquement -->
            </div>

            <div class="sidebar-footer">
                <div class="user-info" id="userInfo">
                    <span class="user-email" id="userEmail"></span>
                </div>
                <div class="sidebar-footer-buttons">
                    <button class="btn-documents" id="documentsBtn" title="Mes documents">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                    </button>
                    <button class="btn-settings" id="settingsBtn" title="Preferences">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6M3 12h6m6 0h6"/>
                        </svg>
                    </button>
                    <button class="btn-theme" id="themeToggle" title="Changer le theme">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"/>
                            <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                        </svg>
                    </button>
                    <button class="btn-logout" id="logoutBtn" title="Deconnexion">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-container">
            <div class="chat-header">
                <button class="btn-toggle-sidebar" id="toggleSidebar">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                </button>
                <div class="chat-info">
                    <h2 id="chatTitle">Nouvelle conversation</h2>
                    <span class="chat-mode" id="chatMode">ChatBot</span>
                </div>
                <button class="btn-header-icon" id="uploadBtn" data-tooltip="Ajouter des documents">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                </button>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    <h2>ðŸ‘‹ Bienvenue sur MY-IA</h2>
                    <p>Posez-moi vos questions, je suis lÃ  pour vous aider avec vos documents et donnÃ©es indexÃ©es.</p>
                    <div class="suggestions">
                        <button class="suggestion-btn" data-query="Explique-moi comment fonctionne le RAG">Comment fonctionne le RAG ?</button>
                        <button class="suggestion-btn" data-query="Quels sont les fichiers disponibles dans la base de connaissances ?">Quels fichiers sont disponibles ?</button>
                        <button class="suggestion-btn" data-query="Comment puis-je ajouter de nouveaux documents ?">Ajouter des documents</button>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <form id="chatForm" class="chat-form">
                    <textarea
                        id="messageInput"
                        placeholder="Ã‰crivez votre message... (Shift + EntrÃ©e pour nouvelle ligne)"
                        rows="1"
                    ></textarea>
                    <button type="submit" class="btn-send" id="sendBtn" title="Envoyer le message">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                        </svg>
                    </button>
                    <button type="button" class="btn-stop" id="stopBtn" style="display: none;" title="Arreter la generation">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12" rx="2"/>
                        </svg>
                    </button>
                </form>
                <div class="input-options">
                    <label class="mode-toggle">
                        <input type="checkbox" id="modeToggle">
                        <span>Mode Assistant</span>
                        <button type="button" class="btn-help" id="modeHelpBtn" title="En savoir plus">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                        </button>
                    </label>

                    <!-- Tooltip d'aide -->
                    <div class="mode-help-tooltip" id="modeHelpTooltip" style="display: none;">
                        <div class="tooltip-content">
                            <h4>ðŸ“š Modes disponibles</h4>
                            <div class="mode-comparison">
                                <div class="mode-info">
                                    <strong>ðŸ’¬ ChatBot</strong>
                                    <p>Conversationnel, explications dÃ©taillÃ©es</p>
                                    <small>Ex: "Qu'est-ce que le RAG ?"</small>
                                </div>
                                <div class="mode-info">
                                    <strong>ðŸŽ¯ Assistant</strong>
                                    <p>Plans d'action, tÃ¢ches structurÃ©es</p>
                                    <small>Ex: "CrÃ©e un runbook de dÃ©ploiement"</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <span class="char-count" id="charCount">0 caractÃ¨res</span>
                </div>
            </div>
        </main>

        <!-- Settings Panel - Preferences utilisateur uniquement -->
        <div class="settings-panel" id="settingsPanel" style="display: none;">
            <div class="settings-content">
                <div class="settings-header">
                    <h2>Preferences</h2>
                    <button class="btn-close" id="closeSettings">Ã—</button>
                </div>
                <div class="settings-body">
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="showSources">
                            Afficher les sources utilisees
                        </label>
                        <small>Affiche les documents utilises pour generer la reponse</small>
                    </div>
                    <div class="setting-group">
                        <label for="defaultMode">Mode par defaut</label>
                        <select id="defaultMode">
                            <option value="1">ChatBot</option>
                            <option value="2">Assistant</option>
                        </select>
                        <small>Mode utilise pour les nouvelles conversations</small>
                    </div>
                    <div class="setting-group">
                        <button class="btn-primary" id="saveSettings">Enregistrer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Modal -->
        <div class="upload-modal" id="uploadModal" style="display: none;">
            <div class="upload-modal-content">
                <div class="upload-modal-header">
                    <h2>ðŸ“Ž Ajouter des documents</h2>
                    <button class="btn-close" id="closeUploadModal">Ã—</button>
                </div>
                <div class="upload-modal-body">
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p id="progressText">Upload en cours...</p>
                    </div>
                    <div class="upload-zone" id="uploadZone">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <p>Glissez vos fichiers ici ou cliquez pour sÃ©lectionner</p>
                        <small>Formats supportÃ©s: PDF, DOCX, XLSX, PPTX, TXT, MD, HTML, JSONL, Images (OCR)</small>
                        <input type="file" id="fileInput" accept=".pdf,.txt,.md,.html,.htm,.jsonl,.json,.csv,.docx,.doc,.xlsx,.xls,.pptx,.ppt,.png,.jpg,.jpeg" multiple style="display: none;">
                    </div>
                    <div class="upload-files-list" id="uploadFilesList"></div>
                </div>
                <div class="upload-modal-footer">
                    <button class="btn-secondary" id="cancelUpload">Annuler</button>
                    <button class="btn-primary" id="startUpload" disabled>Envoyer</button>
                </div>
            </div>
        </div>

        <!-- Documents Modal -->
        <div class="documents-modal" id="documentsModal" style="display: none;">
            <div class="documents-modal-content">
                <div class="documents-modal-header">
                    <h2>ðŸ“„ Mes documents</h2>
                    <button class="btn-close" id="closeDocumentsModal">Ã—</button>
                </div>

                <!-- Storage Stats -->
                <div class="documents-storage-bar" id="documentsStorageBar">
                    <div class="storage-info">
                        <span id="storageUsed">0 Mo</span> / <span id="storageQuota">100 Mo</span>
                    </div>
                    <div class="storage-progress">
                        <div class="storage-fill" id="storageFill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Toolbar -->
                <div class="documents-toolbar">
                    <div class="documents-search">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="documentsSearch" placeholder="Rechercher...">
                    </div>
                    <div class="documents-filters">
                        <select id="documentsVisibilityFilter">
                            <option value="">Tous</option>
                            <option value="public">Publics</option>
                            <option value="private">Prives</option>
                        </select>
                    </div>
                    <button class="btn-primary btn-sm" id="documentsUploadBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        Ajouter
                    </button>
                </div>

                <!-- Documents List -->
                <div class="documents-list" id="documentsList">
                    <div class="documents-loading">Chargement...</div>
                </div>

                <!-- Pagination -->
                <div class="documents-pagination" id="documentsPagination" style="display: none;">
                    <button class="btn-pagination" id="docsPrevPage" disabled>Precedent</button>
                    <span class="pagination-info" id="docsPaginationInfo">Page 1/1</span>
                    <button class="btn-pagination" id="docsNextPage" disabled>Suivant</button>
                </div>
            </div>
        </div>

        <!-- Document Details Modal -->
        <div class="document-details-modal" id="documentDetailsModal" style="display: none;">
            <div class="document-details-content">
                <div class="document-details-header">
                    <h2 id="documentDetailsTitle">Details du document</h2>
                    <button class="btn-close" id="closeDocumentDetails">Ã—</button>
                </div>
                <div class="document-details-body" id="documentDetailsBody">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Libs externes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Services -->
    <script src="js/config.js"></script>
    <script src="js/services/auth.js"></script>
    <script src="js/services/api.js"></script>

    <!-- Utils -->
    <script src="js/utils/dom.js"></script>
    <script src="js/utils/format.js"></script>

    <!-- Components -->
    <script src="js/components/toast.js"></script>
    <script src="js/components/confirm.js"></script>
    <script src="js/components/markdown.js"></script>

    <!-- Modules -->
    <script src="js/modules/settings.js"></script>
    <script src="js/modules/conversations.js"></script>
    <script src="js/modules/messages.js"></script>
    <script src="js/modules/streaming.js"></script>
    <script src="js/modules/upload.js"></script>
    <script src="js/modules/documents.js"></script>

    <!-- App (point d'entree) -->
    <script src="js/app.js?v=14"></script>

    <!-- Masquer le loader une fois tout charge -->
    <script>
        window.addEventListener('load', function() {
            var loader = document.getElementById('app-loader');
            if (loader) {
                loader.classList.add('loaded');
                setTimeout(function() {
                    loader.remove();
                }, 300);
            }
        });
    </script>
</body>
</html>
