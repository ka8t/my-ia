<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY-IA - Interface de Chat</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>MY-IA</h1>
                <button class="btn-new-chat" id="newChatBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Nouvelle conversation
                </button>
            </div>

            <div class="conversations-list" id="conversationsList">
                <!-- Les conversations seront ajout√©es ici dynamiquement -->
            </div>

            <div class="sidebar-footer">
                <button class="btn-settings" id="settingsBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6M3 12h6m6 0h6"/>
                    </svg>
                    Param√®tres
                </button>
                <button class="btn-theme" id="themeToggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                </button>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-container">
            <div class="chat-header">
                <button class="btn-toggle-sidebar" id="toggleSidebar">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                </button>
                <div class="chat-info">
                    <h2 id="chatTitle">Nouvelle conversation</h2>
                    <span class="chat-mode" id="chatMode">ChatBot</span>
                </div>
                <button class="btn-upload" id="uploadBtn" title="Ajouter des documents">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    Ajouter documents
                </button>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    <h2>üëã Bienvenue sur MY-IA</h2>
                    <p>Posez-moi vos questions, je suis l√† pour vous aider avec vos documents et donn√©es index√©es.</p>
                    <div class="suggestions">
                        <button class="suggestion-btn" data-query="Explique-moi comment fonctionne le RAG">Comment fonctionne le RAG ?</button>
                        <button class="suggestion-btn" data-query="Quels sont les fichiers disponibles dans la base de connaissances ?">Quels fichiers sont disponibles ?</button>
                        <button class="suggestion-btn" data-query="Comment puis-je ajouter de nouveaux documents ?">Ajouter des documents</button>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <form id="chatForm" class="chat-form">
                    <textarea
                        id="messageInput"
                        placeholder="√âcrivez votre message... (Shift + Entr√©e pour nouvelle ligne)"
                        rows="1"
                    ></textarea>
                    <button type="submit" class="btn-send" id="sendBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                        </svg>
                    </button>
                    <button type="button" class="btn-stop" id="stopBtn" style="display: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12" rx="2"/>
                        </svg>
                    </button>
                </form>
                <div class="input-options">
                    <label class="mode-toggle">
                        <input type="checkbox" id="modeToggle">
                        <span>Mode Assistant</span>
                        <button type="button" class="btn-help" id="modeHelpBtn" title="En savoir plus">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                        </button>
                    </label>

                    <!-- Tooltip d'aide -->
                    <div class="mode-help-tooltip" id="modeHelpTooltip" style="display: none;">
                        <div class="tooltip-content">
                            <h4>üìö Modes disponibles</h4>
                            <div class="mode-comparison">
                                <div class="mode-info">
                                    <strong>üí¨ ChatBot</strong>
                                    <p>Conversationnel, explications d√©taill√©es</p>
                                    <small>Ex: "Qu'est-ce que le RAG ?"</small>
                                </div>
                                <div class="mode-info">
                                    <strong>üéØ Assistant</strong>
                                    <p>Plans d'action, t√¢ches structur√©es</p>
                                    <small>Ex: "Cr√©e un runbook de d√©ploiement"</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <span class="char-count" id="charCount">0 caract√®res</span>
                </div>
            </div>
        </main>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel" style="display: none;">
            <div class="settings-content">
                <div class="settings-header">
                    <h2>Param√®tres</h2>
                    <button class="btn-close" id="closeSettings">√ó</button>
                </div>
                <div class="settings-body">
                    <div class="setting-group">
                        <label for="apiUrl">URL de l'API</label>
                        <input type="text" id="apiUrl" value="http://localhost:8080" placeholder="http://localhost:8080">
                    </div>
                    <div class="setting-group">
                        <label for="apiKey">Cl√© API (optionnelle)</label>
                        <input type="password" id="apiKey" placeholder="change-me-in-production">
                    </div>
                    <div class="setting-group">
                        <label for="topK">Nombre de sources (TOP_K)</label>
                        <input type="number" id="topK" value="4" min="1" max="10">
                        <small>Nombre de documents √† r√©cup√©rer pour le contexte</small>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="showSources">
                            Afficher les sources utilis√©es
                        </label>
                    </div>
                    <div class="setting-group">
                        <button class="btn-primary" id="saveSettings">Enregistrer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Modal -->
        <div class="upload-modal" id="uploadModal" style="display: none;">
            <div class="upload-modal-content">
                <div class="upload-modal-header">
                    <h2>üìé Ajouter des documents</h2>
                    <button class="btn-close" id="closeUploadModal">√ó</button>
                </div>
                <div class="upload-modal-body">
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p id="progressText">Upload en cours...</p>
                    </div>
                    <div class="upload-zone" id="uploadZone">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <p>Glissez vos fichiers ici ou cliquez pour s√©lectionner</p>
                        <small>Formats support√©s: PDF, TXT, MD, HTML, JSONL</small>
                        <input type="file" id="fileInput" accept=".pdf,.txt,.md,.html,.jsonl" multiple style="display: none;">
                    </div>
                    <div class="upload-files-list" id="uploadFilesList"></div>
                </div>
                <div class="upload-modal-footer">
                    <button class="btn-secondary" id="cancelUpload">Annuler</button>
                    <button class="btn-primary" id="startUpload" disabled>Envoyer</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="js/app.js?v=8"></script>
</body>
</html>
