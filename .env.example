# ============================================
# MY-IA - Variables d'environnement (EXEMPLE)
# ============================================
# Copiez ce fichier vers .env et modifiez les valeurs.
# IMPORTANT: Changez TOUTES les valeurs "change-me-*" avant déploiement !
# ============================================

# =============================================================================
# FRONTEND (Next.js)
# =============================================================================
# Hôte sur lequel le frontend écoute (localhost pour dev, 0.0.0.0 pour Docker)
FRONTEND_HOST=localhost

# Port du serveur frontend Next.js
FRONTEND_PORT=3000

# URL de l'API backend appelée par le frontend (côté client)
API_URL=http://localhost:8080

# =============================================================================
# APPLICATION (FastAPI Backend)
# =============================================================================
# Nom affiché dans la documentation Swagger et les logs
APP_NAME=MY-IA API

# Version de l'API (affichée dans /health et Swagger)
APP_VERSION=1.0.0

# Adresse d'écoute du serveur (0.0.0.0 = toutes les interfaces)
APP_HOST=0.0.0.0

# Port HTTP du backend FastAPI
APP_PORT=8080

# Mode debug (true = rechargement auto, stack traces détaillées)
DEBUG=false

# Niveau de log : DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Environnement : development, staging, production
# Affecte certains comportements (CORS, sécurité, etc.)
ENVIRONMENT=development


# =============================================================================
# JWT Authentication (FastAPI-Users)
# =============================================================================
# Clé secrète pour signer les tokens JWT (256 bits minimum)
# Générer avec: openssl rand -hex 32
# CRITIQUE: Changez cette valeur en production !
JWT_SECRET_KEY=change-me-generate-with-openssl-rand-hex-32

# Algorithme de signature JWT (HS256 = HMAC-SHA256)
JWT_ALGORITHM=HS256

# Durée de validité du token d'accès (en minutes)
# Après expiration, l'utilisateur doit se reconnecter ou utiliser le refresh token
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Durée de validité du refresh token (en jours)
# Permet de renouveler le token d'accès sans re-authentification
REFRESH_TOKEN_EXPIRE_DAYS=7


# =============================================================================
# DATABASE (PostgreSQL)
# =============================================================================
# Super-utilisateur PostgreSQL (pour création initiale de la DB)
# Utilisé uniquement par le script d'init Docker
POSTGRES_USER=postgres
POSTGRES_PASSWORD=change-me-in-production

# Identifiants de l'application pour accéder à la base
# Créés automatiquement au premier démarrage du container postgres
APP_DB_USER=myia_user
APP_DB_PASSWORD=change-me-in-production
APP_DB_NAME=myia_db

# URL de connexion complète (format SQLAlchemy asyncpg)
# Syntaxe: postgresql+asyncpg://user:password@host:port/database
# Les variables ${} sont interpolées par Docker Compose
DATABASE_URL=postgresql+asyncpg://${APP_DB_USER}:${APP_DB_PASSWORD}@postgres:5432/${APP_DB_NAME}


# =============================================================================
# OLLAMA (LLM - Large Language Model)
# =============================================================================
# Hôte du serveur Ollama (nom du service Docker ou IP)
OLLAMA_HOST=ollama

# Port de l'API Ollama (11434 par défaut)
OLLAMA_PORT=11434

# Modèle LLM pour la génération de réponses
# Options: gemma2:2b, mistral, llama3.2, etc.
# Note: Le modèle doit être téléchargé dans Ollama avant utilisation
LLM_MODEL=llama3.2:1b

# Modèle pour les embeddings (vectorisation du texte)
# Utilisé pour la recherche sémantique dans ChromaDB
EMBED_MODEL=nomic-embed-text


# =============================================================================
# CHROMADB (Base de données vectorielle)
# =============================================================================
# Hôte du serveur ChromaDB (nom du service Docker)
CHROMA_HOST=chroma

# Port de l'API ChromaDB
CHROMA_PORT=8000

# Nom de la collection pour stocker les documents RAG
# Une collection = un index de recherche vectorielle
COLLECTION_NAME=knowledge_base

# Chemin de persistance (utilisé si mode fichier, non utilisé avec HttpClient)
CHROMA_PATH=/chroma/chroma


# =============================================================================
# N8N (Workflow Automation) - Optionnel
# =============================================================================
# Identifiants pour la base PostgreSQL de N8N
N8N_DB_USER=n8n
N8N_DB_PASSWORD=change-me-in-production
N8N_DB_NAME=n8n

# Configuration N8N
N8N_PASSWORD=change-me-in-production
N8N_HOST=localhost
N8N_PORT=5678
N8N_PROTOCOL=http
WEBHOOK_URL=http://localhost:5678/
GENERIC_TIMEZONE=Europe/Paris


# =============================================================================
# RAG CONFIGURATION (Retrieval-Augmented Generation)
# =============================================================================
# Nombre de chunks (fragments) retournés lors d'une recherche
# Plus élevé = plus de contexte, mais plus lent et coûteux
TOP_K=4

# Taille maximale d'un chunk en caractères
# Affecte la granularité de la recherche
CHUNK_SIZE=1000

# Chevauchement entre chunks (en caractères)
# Évite de couper le contexte entre deux fragments
CHUNK_OVERLAP=200

# Stratégie de découpage: semantic (intelligent) ou fixed (taille fixe)
# semantic: utilise des limites naturelles (paragraphes, phrases)
CHUNKING_STRATEGY=semantic

# Répertoire contenant les datasets à indexer
DATASETS_DIR=/code/datasets


# =============================================================================
# SECURITY (Sécurité)
# =============================================================================
# Clé API pour les endpoints protégés (legacy, utilisez JWT de préférence)
API_KEY=change-me-in-production

# Clé secrète générale de l'application
# Utilisée pour diverses opérations cryptographiques
SECRET_KEY=change-me-in-production

# Clé de chiffrement des données personnelles (PII)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# CRITIQUE: Cette clé chiffre les données sensibles des utilisateurs !
# - Format: 64 caractères hexadécimaux (256 bits)
# - Générer avec: openssl rand -hex 32
# - NE JAMAIS PERDRE cette clé = perte des données chiffrées
# - NE JAMAIS PARTAGER cette clé
# - Utilisé pour: first_name, last_name, phone, address (champs PII)
# - Algorithme: AES-256-GCM avec dérivation HKDF
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ENCRYPTION_KEY=change-me-generate-with-openssl-rand-hex-32


# =============================================================================
# CORS (Cross-Origin Resource Sharing)
# =============================================================================
# Liste des origines autorisées, séparées par des virgules
# Utilisez * uniquement en développement !
CORS_ORIGINS=*


# =============================================================================
# RATE LIMITING (Limitation de débit)
# =============================================================================
# Format: nombre/période (minute, hour, day)
# Protège contre les abus et la surcharge du serveur

# Limite pour l'endpoint /chat (génération de réponses)
RATE_LIMIT_CHAT=30/minute

# Limite pour l'endpoint /upload (téléversement de documents)
RATE_LIMIT_UPLOAD=10/minute

# Limite pour l'endpoint /stream (streaming de réponses)
RATE_LIMIT_STREAM=20/minute


# =============================================================================
# TIMEOUTS (Délais d'expiration)
# =============================================================================
# Timeout pour les appels à Ollama (génération LLM = lent)
# En secondes. 600s = 10 minutes pour les gros modèles
OLLAMA_TIMEOUT=600.0

# Timeout pour les requêtes HTTP générales
HTTP_TIMEOUT=30.0

# Timeout pour les health checks (vérification de santé)
HEALTH_CHECK_TIMEOUT=5.0


# =============================================================================
# TESTS (Environnement de test)
# =============================================================================
# Identifiants de l'utilisateur de test créé automatiquement
TEST_USER_EMAIL=test@example.com
TEST_USER_PASSWORD=change-me-in-production


# =============================================================================
# NOTES DE PRODUCTION
# =============================================================================
# 1. Changez TOUS les mots de passe et clés secrètes !
# 2. Utilisez des mots de passe forts (20+ caractères, aléatoires)
# 3. Activez HTTPS obligatoire (TLS/SSL)
# 4. Considérez l'utilisation de:
#    - Docker Secrets (docker swarm)
#    - HashiCorp Vault
#    - AWS Secrets Manager / GCP Secret Manager
# 5. Limitez les accès réseau (firewall, VPC)
# 6. Sauvegardez régulièrement ENCRYPTION_KEY de manière sécurisée
